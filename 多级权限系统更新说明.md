# 多级权限系统更新说明

## 更新概述
实现了多级权限系统，支持两种用户类型：普通用户和管理员，提供不同的功能权限。

## 主要功能

### 1. 双密码登录系统
- **普通用户密码**: 只能发布HTML文件，生成分享链接，无法访问管理页面
- **管理员密码**: 拥有完全权限，可以访问管理页面，管理所有内容

### 2. 权限分级
#### 普通用户权限 (user)
- ✅ 登录系统
- ✅ 创建和分享HTML/Markdown/SVG/Mermaid内容
- ✅ 设置密码保护
- ❌ 无法看到管理页面按钮
- ❌ 无法访问管理功能

#### 管理员权限 (admin)
- ✅ 所有普通用户权限
- ✅ 访问管理页面
- ✅ 查看所有页面列表
- ✅ 查看受保护页面的密码
- ✅ 删除任意页面
- ✅ 批量删除页面
- ✅ 查看系统统计信息

### 3. 管理页面增强功能
- **密码显示**: 管理员可以查看受保护页面的访问密码
- **密码复制**: 点击密码可以快速复制到剪贴板
- **悬停提示**: 表格单元格悬停显示完整内容
- **权限保护**: 所有管理功能都需要管理员权限

## 配置说明

### 环境变量
```bash
# 启用认证功能
AUTH_ENABLED=true

# 管理员密码（完全权限）
ADMIN_PASSWORD=your_admin_password

# 普通用户密码（只能发布HTML）
USER_PASSWORD=your_user_password

# 向后兼容：如果只设置AUTH_PASSWORD，则作为管理员密码
AUTH_PASSWORD=your_admin_password
```

### Docker 配置
在 `docker-compose.yml` 中：
```yaml
environment:
  - AUTH_ENABLED=true
  - ADMIN_PASSWORD=Admin@123  # 管理员密码
  - USER_PASSWORD=user123         # 普通用户密码
  - AUTH_PASSWORD=Admin@123  # 向后兼容
```

## 技术实现

### 1. 配置系统
- 修改 `config.js`，支持两种密码配置
- 保持向后兼容，`AUTH_PASSWORD` 作为管理员密码

### 2. 认证中间件
- `isAuthenticated`: 检查是否已登录（任何用户类型）
- `isAdmin`: 检查是否为管理员用户
- 在session中存储用户类型 (`userType`)

### 3. 登录逻辑
- 支持两种密码验证
- 根据密码类型设置用户类型
- 在session中保存认证状态和用户类型

### 4. 权限控制
- 首页根据用户类型显示不同内容
- 管理页面路由使用 `isAdmin` 中间件保护
- 所有管理API都需要管理员权限

### 5. 管理页面功能
- 显示受保护页面的访问密码
- 点击密码复制功能
- 表格悬停显示完整内容
- 优化的用户界面

## 使用说明

### 1. 普通用户使用
1. 使用普通用户密码登录
2. 可以创建和分享内容
3. 可以设置密码保护
4. 看不到管理页面按钮

### 2. 管理员使用
1. 使用管理员密码登录
2. 可以看到管理页面按钮
3. 点击进入管理页面
4. 查看所有页面信息
5. 点击密码可以复制
6. 可以删除任意页面

### 3. 密码管理
- 受保护页面的密码在管理页面中显示
- 点击密码可以快速复制
- 密码以红色高亮显示，便于识别

## 安全特性

### 1. 权限隔离
- 普通用户无法访问管理功能
- 管理员权限严格验证
- 所有敏感操作都需要管理员权限

### 2. 会话管理
- 用户类型存储在安全的服务器端session中
- 支持Cookie和Session双重认证
- 自动权限验证

### 3. 密码保护
- 页面访问密码只对管理员可见
- 密码复制功能安全实现
- 防止未授权访问

## 向后兼容

### 1. 配置兼容
- 如果只设置 `AUTH_PASSWORD`，自动作为管理员密码
- 现有配置无需修改即可使用

### 2. 功能兼容
- 现有的认证流程保持不变
- 现有的页面和API继续工作
- 数据库结构无需修改

## 界面改进

### 1. 管理页面
- 新增"访问密码"列
- 密码点击复制功能
- 悬停显示完整内容
- 更好的视觉反馈

### 2. 首页
- 根据权限动态显示管理按钮
- 普通用户界面更简洁
- 管理员可以快速访问管理功能

## 注意事项

1. **密码安全**: 请使用强密码，特别是管理员密码
2. **权限分离**: 普通用户和管理员密码应该不同
3. **定期更换**: 建议定期更换密码
4. **访问控制**: 管理员权限应该谨慎分配

这次更新大大提升了系统的安全性和可管理性，实现了真正的多级权限控制！ 
